<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Which Valorant Agent Are You?</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    :root{
      --bg:#0e1116; --card:#141823; --text:#e7ecf9; --muted:#9ba3bb; --border:rgba(255,255,255,0.08);
      --accent:#ff4655; --pulse:#ff4655; --pulseAlpha:0.35; --gradStart:#ff4655; --gradEnd:#ff8e53;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:radial-gradient(circle at top right,#1a1f2b,#0e1116);color:var(--text);overflow-x:hidden}
    .fade-in{animation:fadeIn .45s ease forwards;opacity:0}
    @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    .container{max-width:960px;margin:40px auto;padding:0 20px}
    header{text-align:center;margin-bottom:28px}
    header h1{font-size:2rem;font-weight:700;margin:0}
    header p{color:var(--muted);margin-top:8px}
    .quiz-card{background:var(--card);border:1px solid var(--border);border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,.4), 0 0 24px color-mix(in srgb, var(--pulse) calc(var(--pulseAlpha)*100%), transparent);overflow:hidden;position:relative}
    .quiz-header{display:flex;justify-content:space-between;align-items:center;padding:18px;background:linear-gradient(135deg,var(--gradStart),var(--gradEnd));color:white;position:relative}
    .quiz-header::after{content:"";position:absolute;inset:0;pointer-events:none;box-shadow:0 0 22px 6px color-mix(in srgb, var(--pulse) calc(var(--pulseAlpha)*100%), transparent)}
    .quiz-header h2{margin:0;font-size:1.1rem;letter-spacing:.4px}
    .btn{background:linear-gradient(135deg,var(--gradStart),var(--gradEnd));border:none;border-radius:10px;color:white;font-weight:600;padding:10px 16px;cursor:pointer;transition:.2s transform,.2s filter;box-shadow:0 0 0 1px rgba(255,255,255,.06),0 8px 20px rgba(0,0,0,.35)}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.05)}
    .btn.secondary{background:#0f1422;border:1px solid var(--border);color:var(--text);box-shadow:none}
    .question{padding:22px;border-top:1px solid var(--border);min-height:200px}
    .question h3{margin:0 0 12px;font-size:1.05rem}
    .options{display:grid;gap:12px}
    label.option{display:flex;align-items:center;gap:10px;background:#191d2b;padding:12px;border-radius:12px;cursor:pointer;border:1px solid var(--border);transition:.18s border-color,.18s background, .18s box-shadow}
    label.option:hover{border-color:var(--accent);background:#1f2537;box-shadow:0 0 14px color-mix(in srgb, var(--pulse) 25%, transparent)}
    input[type=radio]{accent-color:var(--accent)}
    .footer{display:flex;justify-content:space-between;gap:10px;padding:16px;border-top:1px solid var(--border)}
    .progress{color:var(--muted);font-size:.95rem}
    .result{padding:24px;text-align:center}
    .agents{display:flex;flex-wrap:wrap;gap:20px;justify-content:center;margin-top:18px}
    .agent-card{background:#191d2b;border:1px solid var(--border);border-radius:14px;overflow:hidden;width:260px;transition:.3s;opacity:0;animation:fadeIn .8s ease .2s forwards;box-shadow:0 0 0 1px rgba(255,255,255,.04), 0 12px 28px rgba(0,0,0,.45)}
    .agent-card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.5), 0 0 18px color-mix(in srgb, var(--pulse) 30%, transparent)}
    .agent-img{width:100%;height:160px;object-fit:cover}
    .agent-info{padding:14px;text-align:left}
    .agent-info h4{margin:0;font-size:1.1rem}
    .agent-info p{margin:6px 0 0;font-size:.9rem;color:var(--muted)}
    #blackFade{position:fixed;inset:0;background:#000;opacity:0;pointer-events:none;transition:opacity 1s ease;z-index:9999}
    #blackFade.on{opacity:1}
    .audio-controls{display:flex;gap:10px;align-items:center}
    .toggle{appearance:none;background:#0f1422;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}

    /* Click-to-Start overlay */
    #startScreen {
      position: fixed; inset: 0; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: rgba(0,0,0,0.96); color: white;
      z-index: 99999; text-align: center;
    }
    #startBtn {
      padding: 12px 28px; border: none; border-radius: 10px;
      background: linear-gradient(135deg,var(--gradStart),var(--gradEnd));
      color: white; font-weight: 700; font-size: 1.1rem;
      margin-top: 10px; cursor: pointer; box-shadow:0 0 20px rgba(255,70,85,0.4);
    }
    #startBtn:hover { filter: brightness(1.15); transform: scale(1.03); }
  </style>
</head>
<body>

  <!-- Click-to-Start Overlay -->
  <div id="startScreen">
    <p>🎧 Click below to begin the quiz</p>
    <button id="startBtn">Start Quiz</button>
  </div>

  <div class="container fade-in">
    <header>
      <h1>Which Valorant Agent Are You?</h1>
      <p>Discover your true playstyle. Audio-reactive RGB pulse enabled.</p>
    </header>

    <div class="quiz-card fade-in" id="quizCard">
      <div class="quiz-header">
        <h2>Agent Personality Quiz</h2>
        <div class="audio-controls">
          <button class="toggle" id="musicToggle" aria-pressed="true">🔊 Music On</button>
          <button class="btn" id="restartBtn">Restart</button>
        </div>
      </div>

      <div class="question" id="qWrap"></div>
      <div class="footer">
        <span class="progress" id="progress"></span>
        <div style="display:flex;gap:10px">
          <button class="btn secondary" id="prevBtn" type="button">Prev</button>
          <button class="btn" id="nextBtn" type="button">Next</button>
          <button class="btn" id="finishBtn" type="button" style="display:none">Finish</button>
        </div>
      </div>
    </div>

    <div class="result fade-in" id="resultSection" hidden>
      <h2>Your Agent Match</h2>
      <p id="summary"></p>
      <div class="agents" id="agentResults"></div>
    </div>
  </div>

  <div id="blackFade"></div>

  <!-- Dual-path + ogg fallback -->
  <audio id="bgm" preload="auto" loop>
    <source src="zedd_spectrum.mp3" type="audio/mpeg">
    <source src="audio/zedd_spectrum.mp3" type="audio/mpeg">
    <source src="zedd_spectrum.ogg" type="audio/ogg">
    Your browser does not support the audio element.
  </audio>
  <audio id="sfx" src="valorant_ui.mp3" preload="auto"></audio>
  <audio id="resultSfx" src="zedd_final.mp3" preload="auto"></audio>

  <script>
    const QUESTIONS=[
      {q:'What’s your role in the squad?',opts:['Duelist','Controller','Initiator','Sentinel']},
      {q:'Your biggest strength?',opts:['Aim & aggression','Strategy & planning','Team coordination','Defense & utility']},
      {q:'Your ideal map control?',opts:['Entry & rush','Mid control','Support & intel','Anchor sites']},
      {q:'Pick your favorite pace:',opts:['Fast','Slow & methodical','Reactive','Balanced']},
      {q:'Your biggest flaw?',opts:['Overheat','Too passive','Overthink','Tunnel vision']},
      {q:'How do you approach clutch situations?',opts:['Go for duels','Use utility smartly','Stay calm and wait','Outthink the enemy']},
      {q:'Preferred environment?',opts:['Urban streets','High-tech lab','Nature/forest','Industrial site']},
      {q:'You value teammates who are…',opts:['Aggressive','Supportive','Strategic','Reliable']},
      {q:'When under pressure you…',opts:['Take charge','Stay focused','Adapt','Stay defensive']},
      {q:'Weapon of choice?',opts:['Vandal','Phantom','Operator','Sheriff']},
      {q:'How do you handle mistakes?',opts:['Laugh it off','Analyze and learn','Ignore and move on','Get frustrated but improve']},
      {q:'What motivates you to win?',opts:['Competition','Teamwork','Strategy','Improvement']},
      {q:'Your communication style?',opts:['Short & direct','Calm & steady','Energetic','Silent but effective']},
      {q:'Pick your color palette:',opts:['Red & Black','Blue & Silver','Green & Teal','Purple & Gold']},
      {q:'You play Valorant mostly for…',opts:['Adrenaline','Tactics','Fun with friends','Mastery']}
    ];

    // Full roster with traits
    const AGENTS=[
      {name:'Astra',role:'Controller',traits:['Slow & methodical','Strategy & planning','Mid control','Outthink the enemy','High-tech lab','Strategic','Stay calm and wait','Operator','Purple & Gold','Mastery']},
      {name:'Breach',role:'Initiator',traits:['Balanced','Team coordination','Support & intel','Entry & rush','Industrial site','Aggressive','Take charge','Vandal','Energetic','Competition']},
      {name:'Brimstone',role:'Controller',traits:['Slow & methodical','Strategy & planning','Anchor sites','Use utility smartly','Industrial site','Reliable','Stay focused','Phantom','Teamwork','Blue & Silver','Tactics']},
      {name:'Chamber',role:'Sentinel',traits:['Slow & methodical','Defense & utility','Mid control','Go for duels','Urban streets','Reliable','Take charge','Operator','Short & direct','Competition','Purple & Gold']},
      {name:'Clove',role:'Controller',traits:['Reactive','Strategy & planning','Support & intel','Balanced','Urban streets','Energetic','Adapt','Vandal','Fun with friends']},
      {name:'Cypher',role:'Sentinel',traits:['Slow & methodical','Defense & utility','Anchor sites','Outthink the enemy','Urban streets','Strategic','Stay focused','Operator','Short & direct','Tactics']},
      {name:'Deadlock',role:'Sentinel',traits:['Slow & methodical','Defense & utility','Anchor sites','Use utility smartly','Industrial site','Reliable','Stay focused','Phantom','Calm & steady','Teamwork']},
      {name:'Fade',role:'Initiator',traits:['Slow & methodical','Team coordination','Support & intel','Outthink the enemy','Urban streets','Strategic','Stay calm and wait','Operator','Purple & Gold','Tactics']},
      {name:'Gekko',role:'Initiator',traits:['Reactive','Team coordination','Support & intel','Balanced','Urban streets','Supportive','Adapt','Vandal','Energetic','Fun with friends']},
      {name:'Harbor',role:'Controller',traits:['Balanced','Strategy & planning','Support & intel','Use utility smartly','Nature/forest','Reliable','Adapt','Phantom','Teamwork','Blue & Silver','Fun with friends']},
      {name:'Iso',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Industrial site','Aggressive','Take charge','Sheriff','Short & direct','Competition']},
      {name:'Jett',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Urban streets','Aggressive','Take charge','Vandal','Laugh it off','Competition','Short & direct','Red & Black','Adrenaline']},
      {name:'KAYO',role:'Initiator',traits:['Balanced','Team coordination','Support & intel','Use utility smartly','High-tech lab','Reliable','Stay focused','Vandal','Short & direct','Tactics']},
      {name:'Killjoy',role:'Sentinel',traits:['Slow & methodical','Defense & utility','Anchor sites','Use utility smartly','High-tech lab','Strategic','Analyze and learn','Phantom','Calm & steady','Mastery','Blue & Silver']},
      {name:'Neon',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','High-tech lab','Aggressive','Take charge','Vandal','Energetic','Competition']},
      {name:'Omen',role:'Controller',traits:['Slow & methodical','Strategy & planning','Mid control','Use utility smartly','Outthink the enemy','High-tech lab','Strategic','Stay focused','Phantom','Purple & Gold','Tactics']},
      {name:'Phoenix',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Urban streets','Aggressive','Take charge','Vandal','Energetic','Fun with friends','Red & Black']},
      {name:'Raze',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Urban streets','Aggressive','Take charge','Vandal','Energetic','Competition','Red & Black','Adrenaline']},
      {name:'Reyna',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Urban streets','Aggressive','Take charge','Sheriff','Short & direct','Competition','Red & Black','Adrenaline']},
      {name:'Sage',role:'Sentinel',traits:['Slow & methodical','Defense & utility','Anchor sites','Stay calm and wait','High-tech lab','Supportive','Reliable','Sheriff','Calm & steady','Teamwork','Blue & Silver']},
      {name:'Skye',role:'Initiator',traits:['Balanced','Team coordination','Support & intel','Reactive','Nature/forest','Supportive','Adapt','Phantom','Teamwork','Green & Teal','Fun with friends']},
      {name:'Sova',role:'Initiator',traits:['Balanced','Team coordination','Support & intel','Use utility smartly','High-tech lab','Strategic','Stay calm and wait','Phantom','Teamwork','Blue & Silver','Tactics']},
      {name:'Tejo',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Urban streets','Aggressive','Take charge','Vandal','Energetic','Competition']},
      {name:'Veto',role:'Initiator',traits:['Balanced','Team coordination','Support & intel','Use utility smartly','Industrial site','Strategic','Adapt','Phantom','Teamwork']},
      {name:'Viper',role:'Controller',traits:['Slow & methodical','Strategy & planning','Anchor sites','Outthink the enemy','High-tech lab','Strategic','Stay focused','Phantom','Purple & Gold','Tactics']},
      {name:'Vyse',role:'Sentinel',traits:['Slow & methodical','Defense & utility','Anchor sites','Outthink the enemy','High-tech lab','Strategic','Stay focused','Operator','Mastery']},
      {name:'Waylay',role:'Duelist',traits:['Fast','Aim & aggression','Entry & rush','Go for duels','Urban streets','Aggressive','Take charge','Vandal','Competition']},
      {name:'Yoru',role:'Duelist',traits:['Fast','Aim & aggression','Reactive','Go for duels','Urban streets','Aggressive','Take charge','Operator','Short & direct','Competition']}
    ];

    const qWrap=document.getElementById('qWrap');
    const progressEl=document.getElementById('progress');
    const prevBtn=document.getElementById('prevBtn');
    const nextBtn=document.getElementById('nextBtn');
    const finishBtn=document.getElementById('finishBtn');
    const resultSection=document.getElementById('resultSection');
    const summary=document.getElementById('summary');
    const agentResults=document.getElementById('agentResults');
    const restartBtn=document.getElementById('restartBtn');
    const musicToggle=document.getElementById('musicToggle');
    const bgm=document.getElementById('bgm');
    const sfx=document.getElementById('sfx');
    const resultSfx=document.getElementById('resultSfx');
    const blackFade=document.getElementById('blackFade');

    // Helpful load error logging for bgm
    bgm.addEventListener('error',()=>console.warn('⚠️ BGM failed to load from provided sources.'));

    let current=0; const answers=new Array(QUESTIONS.length).fill(null);

    function renderQuestion(idx){
      const q=QUESTIONS[idx];
      qWrap.classList.remove('fade-in'); void qWrap.offsetWidth; qWrap.classList.add('fade-in');
      qWrap.innerHTML=`<h3>${idx+1}. ${q.q}</h3>`;
      const opts=document.createElement('div'); opts.className='options';
      q.opts.forEach((opt)=>{
        const id=`q${idx}_${opt.replace(/[^a-z0-9]+/gi,'')}`;
        const label=document.createElement('label'); label.className='option';
        const input=document.createElement('input'); input.type='radio'; input.name='q'+idx; input.id=id; input.value=opt;
        if(answers[idx]===opt) input.checked=true;
        input.addEventListener('change',()=>{answers[idx]=opt; playUI(); updateNav();});
        const span=document.createElement('span'); span.textContent=opt;
        label.appendChild(input); label.appendChild(span);
        opts.appendChild(label);
      });
      qWrap.appendChild(opts);
      progressEl.textContent=`Question ${idx+1} of ${QUESTIONS.length}`;
      updateNav();
      document.getElementById('quizCard').scrollIntoView({behavior:'smooth', block:'center'});
    }

    function updateNav(){
      prevBtn.disabled = current===0;
      const hasAnswer = answers[current]!==null;
      nextBtn.disabled = !hasAnswer || current===QUESTIONS.length-1;
      finishBtn.style.display = current===QUESTIONS.length-1 ? 'inline-block' : 'none';
      finishBtn.disabled = !hasAnswer;
    }

    prevBtn.addEventListener('click',()=>{ if(current>0){ current--; renderQuestion(current);} });
    nextBtn.addEventListener('click',()=>{ if(current<QUESTIONS.length-1){ current++; renderQuestion(current);} });
    finishBtn.addEventListener('click', async ()=>{ await endSequence(); const agent = computeResult(); revealResult(agent); });

    function computeResult(){
      let best=null,bestScore=-1;
      AGENTS.forEach(agent=>{
        let score=0;
        if(answers[0] && answers[0]===agent.role) score+=2; // weight role match
        answers.forEach(ans=>{ if(agent.traits.includes(ans)) score++; });
        if(score>bestScore){bestScore=score;best=agent;}
      });
      return best || AGENTS[0];
    }

    function revealResult(agent){
      resultSection.hidden=false;
      summary.textContent=`You match ${agent.name} — a ${agent.role}.`;
      const card=document.createElement('div'); card.className='agent-card';
      const img=document.createElement('img'); img.className='agent-img';
      img.src=`agentphotos/${agent.name}_icon.webp`; img.alt=agent.name;
      img.onerror=()=>{img.src='agentphotos/Default_icon.webp';};
      const info=document.createElement('div'); info.className='agent-info';
      info.innerHTML=`<h4>${agent.name}</h4><p>${agent.role}</p>`;
      card.appendChild(img); card.appendChild(info); agentResults.innerHTML=''; agentResults.appendChild(card);
      window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
    }

    // Smooth volume fade utility
    function fadeVolume(target = 0.4, ms = 1500, audio = bgm) {
      const step = 20;
      const diff = target - audio.volume;
      const steps = Math.max(1, ms / step);
      const delta = diff / steps;
      return new Promise(resolve => {
        const interval = setInterval(() => {
          let v = audio.volume + delta;
          if ((delta > 0 && v >= target) || (delta < 0 && v <= target)) {
            v = target; clearInterval(interval); resolve();
          }
          audio.volume = Math.max(0, Math.min(1, v));
        }, step);
      });
    }
    function wait(ms){ return new Promise(r=>setTimeout(r,ms)); }

    async function endSequence(){
      try{ await fadeVolume(0.0, 1200); bgm.pause(); }catch(e){}
      blackFade.classList.add('on'); await wait(800);
      try{ resultSfx.currentTime=0; resultSfx.volume=0.75; await resultSfx.play(); }catch(e){}
      await wait(600); blackFade.classList.remove('on');
      try{ bgm.volume=0.0; await bgm.play(); await fadeVolume(0.4, 900); }catch(e){}
    }

    restartBtn.addEventListener('click',()=>{
      for(let i=0;i<answers.length;i++) answers[i]=null;
      current=0; resultSection.hidden=true; renderQuestion(0);
    });

    // Audio + RGB reactive
    let audioCtx,analyser,srcNode,freqData; let rafId=null; let hue=0;
    function setupAudio(){
      if(audioCtx) return;
      audioCtx=new(window.AudioContext||window.webkitAudioContext)();
      analyser=audioCtx.createAnalyser(); analyser.fftSize=1024;
      freqData=new Uint8Array(analyser.frequencyBinCount);
      srcNode=audioCtx.createMediaElementSource(bgm);
      srcNode.connect(analyser); analyser.connect(audioCtx.destination);
    }
    function avg(arr,s=0,e=arr.length){ let t=0,c=0; for(let i=s;i<e;i++){t+=arr[i];c++;} return c? t/c : 0; }
    function animatePulse(){
      if(!analyser) return;
      analyser.getByteFrequencyData(freqData);
      const bass=avg(freqData,0,10); const highs=avg(freqData,40,120);
      const intensity=Math.min(0.6,(bass/255)*0.6);
      document.documentElement.style.setProperty('--pulseAlpha',intensity.toFixed(3));
      hue=(hue+0.6+highs/1000)%360;
      const gradA=`hsl(${(hue)%360},90%,58%)`;
      const gradB=`hsl(${(hue+30)%360},90%,60%)`;
      document.documentElement.style.setProperty('--pulse',gradA);
      document.documentElement.style.setProperty('--gradStart',gradA);
      document.documentElement.style.setProperty('--gradEnd',gradB);
      rafId=requestAnimationFrame(animatePulse);
    }
    function startReactive(){ if(!audioCtx) setupAudio(); if(!rafId){rafId=requestAnimationFrame(animatePulse);} }

    // Start music with fade-in after user clicks Start
    async function startMusicOnLoad(){
      try{
        setupAudio(); bgm.volume = 0.0;
        await bgm.play(); await fadeVolume(0.4, 1500);
        startReactive();
        musicToggle.textContent='🔊 Music On'; musicToggle.setAttribute('aria-pressed','true');
      }catch(e){
        console.warn('Autoplay blocked, but Start button should have handled it:', e);
      }
    }

    // Manual toggle
    musicToggle.addEventListener('click', async ()=>{
      const on = musicToggle.getAttribute('aria-pressed')==='true';
      if(on){ await fadeVolume(0.0, 600); bgm.pause(); musicToggle.textContent='🔇 Music Off'; musicToggle.setAttribute('aria-pressed','false'); }
      else{ try{ setupAudio(); bgm.volume=0.0; await bgm.play(); await fadeVolume(0.4, 900); startReactive(); }catch(e){} musicToggle.textContent='🔊 Music On'; musicToggle.setAttribute('aria-pressed','true'); }
    });

    // Play UI sound ONLY when selecting an answer
    function playUI(){ try{ const a=sfx.cloneNode(true); a.volume=0.55; a.play().catch(()=>{}); }catch(e){} }

    // Boot quiz UI
    renderQuestion(0);

    // Click-to-start overlay logic (cross-browser autoplay compliance)
    window.addEventListener('load', () => {
      const startScreen = document.getElementById('startScreen');
      const startBtn = document.getElementById('startBtn');
      startBtn.addEventListener('click', async () => {
        startScreen.remove();
        await startMusicOnLoad(); // begin Zedd theme w/ fade-in
      });
    });
  </script>
</body>
</html>
